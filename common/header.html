<script type="text/discourse-plugin" version="0.8">
  const { h } = require("virtual-dom");
  const { createWidget } = require("discourse/widgets/widget");
  
  createWidget("no-results-new-topic", {
    tagName: "div.no-results-action",
  
    html(attrs, state) {
      const searchController = container.lookup("controller:full-page-search");
      if (!searchController || searchController.resultCount !== 0) {
        return;
      }
  
      return h("div.no-results-action", [
        h("button.btn.btn-primary.create-topic", {
          onclick: () => {
            const router = container.lookup("service:router");
            router.transitionTo("discovery.latest").then(() => {
              const newTopicButton = document.querySelector(".btn-default.new-topic-button");
              if (newTopicButton) {
                newTopicButton.click();
              }
            });
          }
        }, I18n.t("topic.create"))
      ]);
    }
  });
  </script>